---
layout: page
title: "Playing around with HuffPollster data"
author: "Olivia Brode-Roger"
date: "February 16, 2016"
permalink : /polls/
---

```{r setup, include=FALSE}
library(ggplot2)
library(reshape2)
library(pollstR)
```

```{r, echo=FALSE, warning=FALSE, fig.width=17, fig.height=10}
d_polls <- pollstr_polls(topic = "2016-president-dem-primary", state = "US", after="2016-01-01", max_pages=500)
d_candidates <- c("Clinton", "Sanders")
d_questions <- subset(d_polls[["questions"]], question == "2016 National Democratic Primary" & choice %in% d_candidates & value > 0)
d_polldata <- merge(d_polls$polls, d_questions, by = "id")

p <- ggplot(d_polldata, aes(x = end_date, y = log(value/(100-value)), color = choice)) + xlim(as.Date(c("2016-01-01", "2016-11-05")))
p <- p + geom_point(alpha = 0.2)
p <- p + geom_smooth(span = 0.5, method="loess")

targets <- read.csv("2016-dem-primary-targets.csv")
results <- read.csv("2016-dem-primary.csv")

state_targets <- data.frame(state = state.abb[match(targets$state, state.name)],
                     date = as.Date(results$Date),
                     CPR_Jan21 = targets$CPR_Clinton_target,
                     Olivia = targets$my_Clinton_target,
                     result = log(results$Clinton_popular_vote/results$Sanders_popular_vote))
state_clinton_targets <- melt(state_targets, id.vars = c("state", "date", "result"))
state_sanders_targets <- state_clinton_targets
state_sanders_targets$result <- -1*state_sanders_targets$result
state_sanders_targets$value <- -1*state_sanders_targets$value

p_states <- p +
  geom_text(data = state_clinton_targets, mapping=aes(x=date, y = result-value, color = variable, label=state), size=5) +
  geom_line(data = state_clinton_targets, mapping=aes(x=date, y = result-value, color = variable, label=state), alpha = 0.5) +
  geom_text(data = state_sanders_targets, mapping=aes(x=date, y = result-value, color = variable, label=state), size=5) +
  geom_line(data = state_sanders_targets, mapping=aes(x=date, y = result-value, color = variable, label=state), alpha = 0.5) +
  theme(text = element_text(size=20))
p_states
```

This chart seeks to satisfy some of my more particular desires in charts, as well as add a bit of information.
I am only using the democratic primary race, due to a target analysis that is *significantly* easier to run in a 2-person race.

- better moving average (with std error!)
- plotting empty space for the future
- I don't like percentages much, I significantly prefer [log odds-ratio]({% post_url 2016-02-13-why-I-prefer-log-odds-ratio %})
- plotting the state results after using [targets to correct them for bias]({% post_url 2016-02-12-playing-with-huffpolster %}).

This doesn't tell us much (yet!), but these new points probably tell us something about how the rest of the country is going to vote, assuming nothing changes.